.segment BANK(BK_MAIN_CODE)
IRQ_GAME_PAL:
	; Acknowledge irq
	MMC3_IRQ_DISABLE
	MMC3_IRQ_ENABLE

	LDA	IRQ_COUNTER
	BEQ	IRQ_GAME_PAL_1
	CMP	#1
	BEQ	IRQ_GAME_PAL_2
	JMP	IRQ_GAME_PAL_3

IRQ_GAME_PAL_1:
	; PPU_DISABLE_BG	; from NMI
	PPU_SCROLL_XY_FINE_X  0, SCROLL_X, 7
	; wait till end of scanline
	DELAY	33

	PPU_ENABLE

	MMC3_IRQ_DISABLE
	MMC3_IRQ_LATCH 155
	MMC3_IRQ_RELOAD
	MMC3_IRQ_ENABLE

	INC	IRQ_COUNTER
	RTS


IRQ_GAME_PAL_2:
	; wait till end of scanline
	DELAY	52
	PPU_DISABLE_BG
	; DELAY	52
	PPU_SCROLL_XY  0, 6, 192

	MMC3_BANK_SELECT  MMC3_CHR_0, #TS_GAME_UI+0
	MMC3_BANK_SELECT  MMC3_CHR_1, #TS_GAME_UI+2

	PPU_ENABLE

	MMC3_IRQ_DISABLE
	MMC3_IRQ_LATCH 44
	MMC3_IRQ_RELOAD
	MMC3_IRQ_ENABLE

	INC	IRQ_COUNTER
	RTS


IRQ_GAME_PAL_3:
	; wait till end of scanline
	; DELAY	53

	PPU_DISABLE

	INC	IRQ_COUNTER
	RTS
