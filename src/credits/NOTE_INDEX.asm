
.segment BANK(BK_CREDITS)

.proc MAP_TIMER_TO_INDEX
	LDY	NOTE_H
	LDA	APU_NTSC_OFFSET,Y
	STA	NOTE_T
	LDA	APU_NTSC_OFFSET+1,Y
	TAY
@loop:	LDA	APU_NTSC_TABLE_L,Y
	CMP	NOTE_L
	BLE	@end
	INY
	CPY	NOTE_T
	BEQ	@end
	JMP	@loop
@end:	TYA
	RTS

.linecont +
.define APU_NTSC_TABLE \
	$07F1, $0780, $0713, $06AD, $064D, $05F3, $059D, $054D, \
	$0500, $04B8, $0475, $0435, $03F8, $03BF, $0389, $0356, \
	$0326, $02F9, $02CE, $02A6, $027F, $025C, $023A, $021A, \
	$01FB, $01DF, $01C4, $01AB, $0193, $017C, $0167, $0152, \
	$013F, $012D, $011C, $010C, $00FD, $00EF, $00E2, $00D2, \
	$00C9, $00BD, $00B3, $00A9, $009F, $0096, $008E, $0086, \
	$007E, $0077, $0070, $006A, $0064, $005E, $0059, $0054, \
	$004F, $004B, $0046, $0042, $003F, $003B, $0038, $0034, \
	$0031, $002F, $002C, $0029, $0027, $0025, $0023, $0021, \
	$001F, $001D, $001B, $001A, $0018, $0017, $0015, $0014, \
	$0013, $0012, $0011, $0010, $000F, $000E, $000D, $000C, \
	$000C, $000B, $000A, $000A, $0009, $0008

; .define APU_PAL_TABLE \
; 	$0760, $06F6, $0692, $0634, $05DB, $0586, $0537, $04EC, \
; 	$04A5, $0462, $0423, $03E8, $03B0, $037B, $0349, $0319, \
; 	$02ED, $02C3, $029B, $0275, $0252, $0231, $0211, $01F3, \
; 	$01D7, $01BD, $01A4, $018C, $0176, $0161, $014D, $013A, \
; 	$0129, $0118, $0108, $00F9, $00EB, $00DE, $00D1, $00C6, \
; 	$00BA, $00B0, $00A6, $009D, $0094, $008B, $0084, $007C, \
; 	$0075, $006E, $0068, $0062, $005D, $0057, $0052, $004E, \
; 	$0049, $0045, $0041, $003E, $003A, $0037, $0034, $0031, \
; 	$002E, $002B, $0029, $0026, $0024, $0022, $0020, $001E, \
; 	$001D, $001B, $0019, $0018, $0016, $0015, $0014, $0013, \
; 	$0012, $0011, $0010, $000F, $000E, $000D, $000C, $000B, \
; 	$000B, $000A, $0009, $0009, $0008, $0008
.linecont -

APU_NTSC_OFFSET:	.byte 93, 36, 24, 17, 12, 9, 5, 3, 0
APU_NTSC_TABLE_L:	.lobytes APU_NTSC_TABLE
; APU_NTSC_TABLE_H:	.hibytes APU_NTSC_TABLE

; APU_PAL_OFFSET: 	.byte 93, 35, 23, 16, 11, 7, 4, 1, 0
; APU_PAL_TABLE_L:	.lobytes APU_PAL_TABLE
; APU_PAL_TABLE_H:	.hibytes APU_PAL_TABLE

; .define APU_NTSC_NOISE_FREQ   4, 8, 16, 32, 64, 96, 128, 160, 202, 254, 380, 508, 762, 1016, 2034, 4068
; .define APU_PAL_NOISE_FREQ    4, 8, 14, 30, 60, 88, 118, 148, 188, 236, 354, 472, 708,  944, 1890, 3778

; APU_NTSC_NOISE_FREQ_L:	.lobytes APU_NTSC_NOISE_FREQ
; APU_NTSC_NOISE_FREQ_H:	.hibytes APU_NTSC_NOISE_FREQ
; APU_PAL_NOISE_FREQ_L:	.lobytes APU_PAL_NOISE_FREQ
; APU_PAL_NOISE_FREQ_H:	.hibytes APU_PAL_NOISE_FREQ
.endproc

.pushseg
.segment "ZP1"
NOTE_L: .RES 1
NOTE_H: .RES 1
NOTE_T: .RES 1
.popseg
